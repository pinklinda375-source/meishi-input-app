<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ååˆºå…¥åŠ›ã‚¢ãƒ—ãƒª</title>
    <meta name="description" content="ååˆºå…¥åŠ›ã‚¢ãƒ—ãƒª">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const BusinessCardTrainingApp = () => {
          const [screen, setScreen] = useState('setup');
          const [totalQuestions, setTotalQuestions] = useState(10);
          const [selectedFields, setSelectedFields] = useState({
            cardNumber: true,
            companyName: true,
            name: true,
            position: true,
            zipCode: true,
            address: true,
            phone: true,
            fax: false,
            mobile: false,
            email: true,
            url: false
          });
          
          const [questions, setQuestions] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [answers, setAnswers] = useState({});
          const [results, setResults] = useState([]);
          const [showResult, setShowResult] = useState(false);
          
          const [startTime, setStartTime] = useState(null);
          const [questionStartTime, setQuestionStartTime] = useState(null);
          const [timeTaken, setTimeTaken] = useState([]);
          const [currentTime, setCurrentTime] = useState(0);
          
          const [history, setHistory] = useState([]);
          
          const [reviewMode, setReviewMode] = useState(false);
          const [incorrectQuestions, setIncorrectQuestions] = useState([]);

          useEffect(() => {
            if (screen === 'training' && questionStartTime) {
              const timer = setInterval(() => {
                setCurrentTime(Date.now() - questionStartTime);
              }, 100);
              return () => clearInterval(timer);
            }
          }, [screen, questionStartTime]);

          useEffect(() => {
            const savedHistory = localStorage.getItem('trainingHistory');
            if (savedHistory) {
              setHistory(JSON.parse(savedHistory));
            }
          }, []);

          const fieldLabels = {
            cardNumber: 'ã‚«ãƒ¼ãƒ‰ç•ªå·',
            companyName: 'ä¼šç¤¾å',
            name: 'æ°å',
            position: 'å½¹è·',
            zipCode: 'éƒµä¾¿ç•ªå·',
            address: 'ä½æ‰€',
            phone: 'é›»è©±ç•ªå·',
            fax: 'FAXç•ªå·',
            mobile: 'æºå¸¯é›»è©±',
            email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
            url: 'URL'
          };

          const lastNames = ['ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ç”°ä¸­', 'ä¼Šè—¤', 'æ¸¡è¾º', 'å±±æœ¬', 'ä¸­æ‘', 'å°æ—', 'åŠ è—¤', 'å‰ç”°', 'å±±ç”°', 'ä½ã€…æœ¨', 'å±±å£', 'æ¾æœ¬', 'äº•ä¸Š', 'æœ¨æ‘', 'æ—', 'æ–è—¤', 'æ¸…æ°´', 'å±±å´', 'æ£®', 'æ± ç”°', 'æ©‹æœ¬', 'é˜¿éƒ¨', 'çŸ³å·', 'å±±ä¸‹', 'ä¸­å³¶', 'å‰ç”°', 'è—¤ç”°', 'å²¡ç”°', 'å¾Œè—¤', 'é•·è°·å·', 'æ‘ä¸Š', 'è¿‘è—¤', 'çŸ³äº•', 'é è—¤', 'é’æœ¨', 'å‚æœ¬', 'ç¦ç”°', 'è¥¿æ‘', 'å¤ªç”°', 'å²¡æœ¬', 'è—¤äº•', 'é‡‘å­', 'ä¸­é‡', 'åŸç”°', 'è—¤åŸ', 'é‡å£', 'ä¸‰æµ¦', 'åŸ', 'èŠåœ°', 'æŸ´ç”°', 'è…åŸ', 'å®®æœ¬', 'é«˜æœ¨', 'å¤§å¡š', 'å°é‡', 'å®‰ç”°', 'ä¸¸å±±', 'æœ›æœˆ', 'å·å´', 'å¹³é‡', 'çŸ³ç”°', 'å°é‡å¯º', 'ä¸Šé‡', 'å²©å´', 'å¤§é‡', 'æ‰å±±', 'æ–°äº•', 'æ¸¡éƒ¨', 'æ¨ªå±±', 'ç†Šè°·', 'çªªç”°', 'æºå£', 'ä¸Šç”°', 'é«˜ç”°', 'æ¤ç”°', 'å°å³¶', 'å²©ç”°', 'çŸ¢é‡', 'å‰å²¡', 'å°æ³‰', 'å°æ²¢', 'é£¯ç”°', 'è‹¥æ¾', 'å®®å´', 'ç«¹å†…', 'ä½é‡', 'èŠæ± ', 'å®‡é‡', 'å‰å·', 'æ‰ç”°', 'è°·å£', 'æ­¦ç”°', 'å°ç”°', 'é ˆè—¤', 'å³¶ç”°', 'å®®ç”°', 'æ¾ç”°', 'å°å·'];
          
          const firstNamesMale = ['å¥å¤ªéƒ', 'å¤§è¼”', 'ç¿”å¤ª', 'æ‹“ä¹Ÿ', 'é”ä¹Ÿ', 'æ·³', 'èª ', 'ä¿®', 'å‰›', 'æµ©', 'éš†', 'è¡', 'æ­£æ¨¹', 'ç§€æ¨¹', 'å“²ä¹Ÿ', 'å’Œä¹Ÿ', 'ç›´æ¨¹', 'é›„ä¸€', 'å„ª', 'æ¶¼ä»‹', 'å¥ä¸€', 'å‹‡', 'èˆª', 'è“®', 'é¢¯å¤ª', 'é™¸', 'æ‚ æ–—', 'é™½ä»‹', 'å¤§åœ°', 'é§¿', 'å°†å¤ª', 'è²´ä¹‹', 'å­', 'è£•äºŒ', 'åº·å¹³', 'æ…ä¸€', 'äº®', 'æ™ºä¹Ÿ', 'å…‰', 'ä»', 'æ¸…', 'æ­£', 'èŒ‚', 'åš', 'å¥', 'å’Œé›„', 'æ˜­é›„', 'éš†å¤«', 'å¹¸å¤«'];
          
          const firstNamesFemale = ['ç¾å’²', 'è£•å­', 'çœŸç”±ç¾', 'æµå­', 'é™½å­', 'éº»è¡£', 'å„ªå­', 'åƒä»£', 'æ„›', 'èˆ', 'çµè¡£', 'èœã€…å­', 'å½©', 'ç¾ç©‚', 'ç”±ç¾', 'æ˜ç¾', 'çœŸç†', 'äº¬å­', 'å‹ç¾', 'ç›´ç¾', 'çµµç¾', 'é¦™ç¹”', 'ç†æµ', 'æ²™ç¹”', 'å¥ˆã€…', 'ç³', 'äºœç¾', 'æ™ºå­', 'å¹¸å­', 'æ¡œ', 'èŠ±å­', 'è‘µ', 'æ¢“', 'èŒœ', 'æ¥“', 'å‡›', 'ç¾å„ª', 'ä¸ƒæµ·', 'é™½èœ', 'å¿ƒ', 'å’Œå­', 'æ´‹å­', 'ç¯€å­', 'æ–‡å­', 'æµ', 'ä¹…ç¾å­'];

          const companyPrefixes = ['æ±äº¬', 'å¤§é˜ª', 'æ¨ªæµœ', 'åå¤å±‹', 'æœ­å¹Œ', 'ç¥æˆ¸', 'äº¬éƒ½', 'ç¦å²¡', 'ä»™å°', 'åºƒå³¶', 'é–¢è¥¿', 'é–¢æ±', 'ä¸­éƒ¨', 'ä¹å·', 'åŒ—æµ·é“', 'æ±åŒ—', 'å››å›½', 'ä¸­å›½', 'åŒ—é™¸', 'é¦–éƒ½åœ', 'æ—¥æœ¬', 'å…¨å›½', 'ä¸­å¤®', 'å¤ªå¹³æ´‹', 'æ—¥æ±', 'è¥¿æ—¥æœ¬', 'æ±æ—¥æœ¬', 'å—é–¢æ±', 'åŒ—é–¢æ±', 'ç”²ä¿¡è¶Š'];
          
          const companyTypes = ['ã‚·ã‚¹ãƒ†ãƒ ', 'å•†äº‹', 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°', 'å»ºè¨­', 'ç‰©æµ', 'ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°', 'ãƒ‡ã‚¶ã‚¤ãƒ³', 'ãƒ•ãƒ¼ã‚º', 'è£½è–¬', 'ãƒˆãƒ©ãƒ™ãƒ«', 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º', 'ã‚¤ãƒ³ãƒ€ã‚¹ãƒˆãƒªãƒ¼', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', 'ä¸å‹•ç”£', 'é–‹ç™º', 'é€šä¿¡', 'é›»å­', 'æ©Ÿæ¢°', 'åŒ–å­¦', 'é‡‘å±', 'ç¹Šç¶­', 'é£Ÿå“', 'é‹è¼¸', 'æƒ…å ±', 'ç·åˆ', 'ã‚µãƒ¼ãƒ“ã‚¹', 'ãƒ—ãƒ©ãƒ³ãƒˆ', 'ç²¾å¯†', 'è‡ªå‹•è»Š'];
          
          const companySuffixes = ['æ ªå¼ä¼šç¤¾', 'æœ‰é™ä¼šç¤¾', 'åˆåŒä¼šç¤¾'];
          const companyDescriptors = ['ãƒ›ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚¹', 'ã‚°ãƒ«ãƒ¼ãƒ—', 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º', 'ãƒ©ãƒœ', 'ãƒªã‚µãƒ¼ãƒ', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹', 'ãƒ†ãƒƒã‚¯', 'ãƒ‡ã‚¸ã‚¿ãƒ«', 'ãƒªãƒ³ã‚¯', 'ãƒ¡ãƒ‡ã‚£ã‚¢', 'ã‚½ãƒ•ãƒˆ', 'ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°'];

          const positions = ['ä»£è¡¨å–ç· å½¹ç¤¾é•·', 'ä»£è¡¨å–ç· å½¹', 'å–ç· å½¹', 'å¸¸å‹™å–ç· å½¹', 'å°‚å‹™å–ç· å½¹', 'å–¶æ¥­éƒ¨é•·', 'å–¶æ¥­éƒ¨ éƒ¨é•·', 'å–¶æ¥­éƒ¨ èª²é•·', 'å–¶æ¥­éƒ¨ ä¿‚é•·', 'å–¶æ¥­éƒ¨ ä¸»ä»»', 'æŠ€è¡“éƒ¨é•·', 'æŠ€è¡“éƒ¨ éƒ¨é•·', 'æŠ€è¡“éƒ¨ èª²é•·', 'æŠ€è¡“éƒ¨ ä¸»ä»»', 'æŠ€è¡“éƒ¨ éƒ¨é•·ä»£ç†', 'ç·å‹™éƒ¨é•·', 'ç·å‹™éƒ¨ éƒ¨é•·', 'ç·å‹™éƒ¨ èª²é•·', 'ç·å‹™éƒ¨ ä¿‚é•·', 'çµŒç†éƒ¨é•·', 'çµŒç†éƒ¨ èª²é•·', 'äººäº‹éƒ¨é•·', 'äººäº‹éƒ¨ èª²é•·', 'ä¼ç”»å–¶æ¥­éƒ¨ éƒ¨é•·', 'ä¼ç”»å–¶æ¥­éƒ¨ èª²é•·', 'ä¼ç”»å–¶æ¥­éƒ¨ ä¿‚é•·', 'é–‹ç™ºéƒ¨ éƒ¨é•·', 'é–‹ç™ºéƒ¨ èª²é•·', 'ç ”ç©¶é–‹ç™ºéƒ¨ ç ”ç©¶å“¡', 'ç ”ç©¶é–‹ç™ºéƒ¨ ä¸»ä»»ç ”ç©¶å“¡', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é•·', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨ èª²é•·', 'è£½é€ éƒ¨é•·', 'è£½é€ éƒ¨ èª²é•·', 'å“è³ªç®¡ç†éƒ¨ èª²é•·', 'ç‰©æµç®¡ç†éƒ¨ éƒ¨é•·', 'ç‰©æµç®¡ç†éƒ¨ èª²é•·', 'è³¼è²·éƒ¨ èª²é•·', 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼', 'ã‚·ãƒ‹ã‚¢ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ', 'ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ', 'ã‚¢ãƒŠãƒªã‚¹ãƒˆ'];

          const locations = [
            { zip: '100-0001', pref: 'æ±äº¬éƒ½', city: 'åƒä»£ç”°åŒºåƒä»£ç”°', area: '03' },
            { zip: '530-0001', pref: 'å¤§é˜ªåºœ', city: 'å¤§é˜ªå¸‚åŒ—åŒºæ¢…ç”°', area: '06' },
            { zip: '460-0008', pref: 'æ„›çŸ¥çœŒ', city: 'åå¤å±‹å¸‚ä¸­åŒºæ „', area: '052' },
            { zip: '810-0001', pref: 'ç¦å²¡çœŒ', city: 'ç¦å²¡å¸‚ä¸­å¤®åŒºå¤©ç¥', area: '092' },
            { zip: '060-0001', pref: 'åŒ—æµ·é“', city: 'æœ­å¹Œå¸‚ä¸­å¤®åŒºåŒ—1æ¡è¥¿', area: '011' },
            { zip: '980-0021', pref: 'å®®åŸçœŒ', city: 'ä»™å°å¸‚é’è‘‰åŒºä¸­å¤®', area: '022' },
            { zip: '220-0011', pref: 'ç¥å¥ˆå·çœŒ', city: 'æ¨ªæµœå¸‚è¥¿åŒºé«˜å³¶', area: '045' },
            { zip: '760-0001', pref: 'é¦™å·çœŒ', city: 'é«˜æ¾å¸‚æµœãƒç”º', area: '087' },
            { zip: '103-0027', pref: 'æ±äº¬éƒ½', city: 'ä¸­å¤®åŒºæ—¥æœ¬æ©‹', area: '03' },
            { zip: '900-0015', pref: 'æ²–ç¸„çœŒ', city: 'é‚£è¦‡å¸‚ä¹…èŒ‚åœ°', area: '098' },
            { zip: '150-0001', pref: 'æ±äº¬éƒ½', city: 'æ¸‹è°·åŒºç¥å®®å‰', area: '03' },
            { zip: '600-8216', pref: 'äº¬éƒ½åºœ', city: 'äº¬éƒ½å¸‚ä¸‹äº¬åŒºçƒä¸¸é€š', area: '075' },
            { zip: '650-0001', pref: 'å…µåº«çœŒ', city: 'ç¥æˆ¸å¸‚ä¸­å¤®åŒºåŠ ç´ç”º', area: '078' },
            { zip: '730-0011', pref: 'åºƒå³¶çœŒ', city: 'åºƒå³¶å¸‚ä¸­åŒºåŸºç”º', area: '082' },
            { zip: '951-8062', pref: 'æ–°æ½ŸçœŒ', city: 'æ–°æ½Ÿå¸‚ä¸­å¤®åŒºè¥¿å €å‰é€š', area: '025' }
          ];

          const randomNum = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
          
          const generatePhone = (area) => `${area}-${randomNum(1000, 9999)}-${randomNum(1000, 9999)}`;
          const generateMobile = () => {
            const prefixes = ['080', '090', '070'];
            return `${prefixes[randomNum(0, 2)]}-${randomNum(1000, 9999)}-${randomNum(1000, 9999)}`;
          };

          const toRomaji = (text) => {
            const romajiMap = {
              'ä½è—¤': 'sato', 'éˆ´æœ¨': 'suzuki', 'é«˜æ©‹': 'takahashi', 'ç”°ä¸­': 'tanaka', 'ä¼Šè—¤': 'ito',
              'æ¸¡è¾º': 'watanabe', 'å±±æœ¬': 'yamamoto', 'ä¸­æ‘': 'nakamura', 'å°æ—': 'kobayashi', 'åŠ è—¤': 'kato',
              'å‰ç”°': 'yoshida', 'å±±ç”°': 'yamada', 'ä½ã€…æœ¨': 'sasaki', 'å±±å£': 'yamaguchi', 'æ¾æœ¬': 'matsumoto',
              'äº•ä¸Š': 'inoue', 'æœ¨æ‘': 'kimura', 'æ—': 'hayashi', 'æ–è—¤': 'saito', 'æ¸…æ°´': 'shimizu',
              'å±±å´': 'yamazaki', 'æ£®': 'mori', 'æ± ç”°': 'ikeda', 'æ©‹æœ¬': 'hashimoto', 'é˜¿éƒ¨': 'abe',
              'çŸ³å·': 'ishikawa', 'å±±ä¸‹': 'yamashita', 'ä¸­å³¶': 'nakajima', 'å‰ç”°': 'maeda', 'è—¤ç”°': 'fujita',
              'å²¡ç”°': 'okada', 'å¾Œè—¤': 'goto', 'é•·è°·å·': 'hasegawa', 'æ‘ä¸Š': 'murakami', 'è¿‘è—¤': 'kondo',
              'çŸ³äº•': 'ishii', 'é è—¤': 'endo', 'é’æœ¨': 'aoki', 'å‚æœ¬': 'sakamoto', 'ç¦ç”°': 'fukuda',
              'è¥¿æ‘': 'nishimura', 'å¤ªç”°': 'ota', 'å²¡æœ¬': 'okamoto', 'è—¤äº•': 'fujii', 'é‡‘å­': 'kaneko',
              'ä¸­é‡': 'nakano', 'åŸç”°': 'harada', 'è—¤åŸ': 'fujiwara', 'é‡å£': 'noguchi', 'ä¸‰æµ¦': 'miura',
              'åŸ': 'hara', 'èŠåœ°': 'kikuchi', 'æŸ´ç”°': 'shibata', 'è…åŸ': 'sugawara', 'å®®æœ¬': 'miyamoto',
              'é«˜æœ¨': 'takagi', 'å¤§å¡š': 'otsuka', 'å°é‡': 'ono', 'å®‰ç”°': 'yasuda', 'ä¸¸å±±': 'maruyama',
              'æœ›æœˆ': 'mochizuki', 'å·å´': 'kawasaki', 'å¹³é‡': 'hirano', 'çŸ³ç”°': 'ishida', 'å°é‡å¯º': 'onodera',
              'ä¸Šé‡': 'ueno', 'å²©å´': 'iwasaki', 'å¤§é‡': 'ono', 'æ‰å±±': 'sugiyama', 'æ–°äº•': 'arai',
              'æ¸¡éƒ¨': 'watanabe', 'æ¨ªå±±': 'yokoyama', 'ç†Šè°·': 'kumagai', 'çªªç”°': 'kubota', 'æºå£': 'mizoguchi',
              'ä¸Šç”°': 'ueda', 'é«˜ç”°': 'takada', 'æ¤ç”°': 'ueda', 'å°å³¶': 'kojima', 'å²©ç”°': 'iwata',
              'çŸ¢é‡': 'yano', 'å‰å²¡': 'yoshioka', 'å°æ³‰': 'koizumi', 'å°æ²¢': 'ozawa', 'é£¯ç”°': 'iida',
              'è‹¥æ¾': 'wakamatsu', 'å®®å´': 'miyazaki', 'ç«¹å†…': 'takeuchi', 'ä½é‡': 'sano', 'èŠæ± ': 'kikuchi',
              'å®‡é‡': 'uno', 'å‰å·': 'yoshikawa', 'æ‰ç”°': 'sugita', 'è°·å£': 'taniguchi', 'æ­¦ç”°': 'takeda',
              'å°ç”°': 'oda', 'é ˆè—¤': 'sudo', 'å³¶ç”°': 'shimada', 'å®®ç”°': 'miyata', 'æ¾ç”°': 'matsuda',
              'å°å·': 'ogawa',
              'å¥å¤ªéƒ': 'kentaro', 'å¤§è¼”': 'daisuke', 'ç¿”å¤ª': 'shota', 'æ‹“ä¹Ÿ': 'takuya', 'é”ä¹Ÿ': 'tatsuya',
              'æ·³': 'jun', 'èª ': 'makoto', 'ä¿®': 'osamu', 'å‰›': 'tsuyoshi', 'æµ©': 'hiroshi',
              'éš†': 'takashi', 'è¡': 'satoshi', 'æ­£æ¨¹': 'masaki', 'ç§€æ¨¹': 'hideki', 'å“²ä¹Ÿ': 'tetsuya',
              'å’Œä¹Ÿ': 'kazuya', 'ç›´æ¨¹': 'naoki', 'é›„ä¸€': 'yuichi', 'å„ª': 'yu', 'æ¶¼ä»‹': 'ryosuke',
              'å¥ä¸€': 'kenichi', 'å‹‡': 'isamu', 'èˆª': 'wataru', 'è“®': 'ren', 'é¢¯å¤ª': 'sota',
              'é™¸': 'riku', 'æ‚ æ–—': 'yuto', 'é™½ä»‹': 'yosuke', 'å¤§åœ°': 'daichi', 'é§¿': 'shun',
              'å°†å¤ª': 'shota', 'è²´ä¹‹': 'takayuki', 'å­': 'takashi', 'è£•äºŒ': 'yuji', 'åº·å¹³': 'kohei',
              'æ…ä¸€': 'shinichi', 'äº®': 'ryo', 'æ™ºä¹Ÿ': 'tomoya', 'å…‰': 'hikaru', 'ä»': 'hitoshi',
              'æ¸…': 'kiyoshi', 'æ­£': 'tadashi', 'èŒ‚': 'shigeru', 'åš': 'hiroshi', 'å¥': 'ken',
              'å’Œé›„': 'kazuo', 'æ˜­é›„': 'akio', 'éš†å¤«': 'takao', 'å¹¸å¤«': 'yukio',
              'ç¾å’²': 'misaki', 'è£•å­': 'yuko', 'çœŸç”±ç¾': 'mayumi', 'æµå­': 'keiko', 'é™½å­': 'yoko',
              'éº»è¡£': 'mai', 'å„ªå­': 'yuko', 'åƒä»£': 'chiyo', 'æ„›': 'ai', 'èˆ': 'mai',
              'çµè¡£': 'yui', 'èœã€…å­': 'nanako', 'å½©': 'aya', 'ç¾ç©‚': 'miho', 'ç”±ç¾': 'yumi',
              'æ˜ç¾': 'akemi', 'çœŸç†': 'mari', 'äº¬å­': 'kyoko', 'å‹ç¾': 'tomomi', 'ç›´ç¾': 'naomi',
              'çµµç¾': 'emi', 'é¦™ç¹”': 'kaori', 'ç†æµ': 'rie', 'æ²™ç¹”': 'saori', 'å¥ˆã€…': 'nana',
              'ç³': 'hitomi', 'äºœç¾': 'ami', 'æ™ºå­': 'tomoko', 'å¹¸å­': 'sachiko', 'æ¡œ': 'sakura',
              'èŠ±å­': 'hanako', 'è‘µ': 'aoi', 'æ¢“': 'azusa', 'èŒœ': 'akane', 'æ¥“': 'kaede',
              'å‡›': 'rin', 'ç¾å„ª': 'miyu', 'ä¸ƒæµ·': 'nanami', 'é™½èœ': 'hina', 'å¿ƒ': 'kokoro',
              'å’Œå­': 'kazuko', 'æ´‹å­': 'yoko', 'ç¯€å­': 'setsuko', 'æ–‡å­': 'fumiko', 'æµ': 'megumi',
              'ä¹…ç¾å­': 'kumiko',
              'æ±': 'to', 'äº¬': 'kyo', 'å¤§': 'o', 'é˜ª': 'saka', 'æ¨ª': 'yoko', 'æµœ': 'hama',
              'å': 'na', 'å¤': 'go', 'å±‹': 'ya', 'æœ­': 'satsu', 'å¹Œ': 'poro', 'ç¥': 'ko',
              'æˆ¸': 'be', 'ç¦': 'fuku', 'å²¡': 'oka', 'ä»™': 'sen', 'å°': 'dai', 'åºƒ': 'hiro',
              'å³¶': 'shima', 'é–¢': 'kan', 'è¥¿': 'sai', 'ä¸­': 'chu', 'éƒ¨': 'bu',
              'ä¹': 'kyu', 'å·': 'shu', 'åŒ—': 'hok', 'æµ·': 'kai', 'é“': 'do', 'å››': 'shi',
              'å›½': 'koku', 'é™¸': 'riku', 'é¦–': 'shu', 'éƒ½': 'to', 'åœ': 'ken', 'æ—¥': 'ni',
              'æœ¬': 'hon', 'å…¨': 'zen', 'å¤®': 'o', 'å¤ª': 'tai', 'å¹³': 'hei', 'æ´‹': 'yo',
              'å—': 'minami', 'ç”²': 'ko', 'ä¿¡': 'shin', 'è¶Š': 'etsu',
              'ã‚·': 'shi', 'ã‚¹': 'su', 'ãƒ†': 'te', 'ãƒ ': 'mu', 'ã‚¨': 'e', 'ãƒ³': 'n',
              'ã‚¸': 'ji', 'ãƒ‹': 'ni', 'ã‚¢': 'a', 'ãƒª': 'ri', 'ã‚°': 'gu', 'ã‚³': 'ko',
              'ã‚µ': 'sa', 'ãƒ«': 'ru', 'ã‚£': 'i', 'ãƒ‡': 'de', 'ã‚¶': 'za', 'ã‚¤': 'i',
              'ãƒ•': 'fu', 'ãƒ¼': '', 'ã‚º': 'zu', 'ãƒˆ': 'to', 'ãƒ©': 'ra', 'ãƒ™': 'be',
              'ãƒ': 'no', 'ãƒ­': 'ro', 'ã‚¯': 'ku', 'ã‚½': 'so', 'ãƒ¥': 'yu', 'ã‚·': 'shi',
              'ãƒ§': 'yo', 'ãƒ€': 'da', 'ãƒ': 'ma', 'ã‚±': 'ke', 'ãƒ“': 'bi', 'ãƒ—': 'pu',
              'ãƒ›': 'ho', 'ãƒŠ': 'na', 'ãƒœ': 'bo', 'ãƒ': 'chi', 'ã‚¿': 'ta',
              'å•†': 'sho', 'äº‹': 'ji', 'å»º': 'ken', 'è¨­': 'setsu', 'ç‰©': 'butsu', 'æµ': 'ryu',
              'è£½': 'sei', 'è–¬': 'yaku', 'ä¸': 'fu', 'å‹•': 'do', 'ç”£': 'san', 'é–‹': 'kai',
              'ç™º': 'hatsu', 'é€š': 'tsu', 'é›»': 'den', 'å­': 'shi', 'æ©Ÿ': 'ki', 'æ¢°': 'kai',
              'åŒ–': 'ka', 'å­¦': 'gaku', 'é‡‘': 'kin', 'å±': 'zoku', 'ç¹Š': 'sen', 'ç¶­': 'i',
              'é£Ÿ': 'shoku', 'å“': 'hin', 'é‹': 'un', 'è¼¸': 'yu', 'æƒ…': 'jo', 'å ±': 'ho',
              'ç·': 'so', 'åˆ': 'go', 'ç²¾': 'sei', 'å¯†': 'mitsu', 'è‡ª': 'ji', 'è»Š': 'sha'
            };

            let result = '';
            for (let i = 0; i < text.length; i++) {
              const char = text[i];
              if (romajiMap[char]) {
                result += romajiMap[char];
              }
            }
            return result;
          };

          const generateCard = () => {
            const location = locations[randomNum(0, locations.length - 1)];
            const lastName = lastNames[randomNum(0, lastNames.length - 1)];
            const isMale = Math.random() > 0.3;
            const firstName = isMale 
              ? firstNamesMale[randomNum(0, firstNamesMale.length - 1)]
              : firstNamesFemale[randomNum(0, firstNamesFemale.length - 1)];
            
            const companyPrefix = companyPrefixes[randomNum(0, companyPrefixes.length - 1)];
            const companyType = companyTypes[randomNum(0, companyTypes.length - 1)];
            const companySuffix = companySuffixes[randomNum(0, companySuffixes.length - 1)];
            const companyDescriptor = companyDescriptors[randomNum(0, companyDescriptors.length - 1)];
            const basePrefix = Math.random() < 0.2 ? '' : companyPrefix;
            const baseName = `${basePrefix}${companyType}`;
            const companyPatterns = [
              `${companySuffix} ${baseName}`,
              `${baseName}${companySuffix}`,
              `${baseName}${companyDescriptor}`,
              `${baseName}ãƒ»${companyDescriptor}`,
              `${companyDescriptor}${baseName}`,
              `${companySuffix} ${baseName}${companyDescriptor}`,
              `${baseName} ${companyDescriptor}`
            ];
            const companyName = companyPatterns[randomNum(0, companyPatterns.length - 1)].replace(/\s+/g, ' ').trim();
            
            const useSecondGiven = Math.random() < 0.08;
            const secondGiven = isMale
              ? firstNamesMale[randomNum(0, firstNamesMale.length - 1)]
              : firstNamesFemale[randomNum(0, firstNamesFemale.length - 1)];
            const givenName = useSecondGiven ? `${firstName}ãƒ»${secondGiven}` : firstName;
            const name = `${lastName} ${givenName}`;
            const position = positions[randomNum(0, positions.length - 1)];
            const building = `${randomNum(1, 10)}-${randomNum(1, 20)}-${randomNum(1, 30)}`;
            const address = `${location.pref}${location.city}${building}`;
            
            const emailDomainRaw = toRomaji(companyName.replace(/æ ªå¼ä¼šç¤¾|æœ‰é™ä¼šç¤¾|åˆåŒä¼šç¤¾|\s|ãƒ»/g, ''));
            const lastNameRomajiRaw = toRomaji(lastName);
            const firstNameRomajiRaw = toRomaji(firstName);
            const domainSeeds = ['sakura', 'mirai', 'kizuna', 'haru', 'ao', 'nexus', 'prime', 'zen', 'axis', 'terra', 'sol', 'core', 'field', 'spark'];
            const emailDomain = emailDomainRaw || domainSeeds[randomNum(0, domainSeeds.length - 1)];
            const lastNameRomaji = lastNameRomajiRaw || 'yamada';
            const firstNameRomaji = firstNameRomajiRaw || 'taro';
            const emailFormats = [
              () => `${firstNameRomaji.charAt(0)}.${lastNameRomaji}`,
              () => `${firstNameRomaji}.${lastNameRomaji}`,
              () => `${lastNameRomaji}.${firstNameRomaji.charAt(0)}`,
              () => `${lastNameRomaji}.${firstNameRomaji}`,
              () => `${firstNameRomaji}${lastNameRomaji}`,
              () => `${lastNameRomaji}${firstNameRomaji}`,
              () => `${lastNameRomaji}_${firstNameRomaji}`,
              () => `${firstNameRomaji}-${lastNameRomaji}`,
              () => `${firstNameRomaji}${lastNameRomaji.charAt(0)}`
            ];
            const localRaw = emailFormats[randomNum(0, emailFormats.length - 1)]();
            const localSanitized = localRaw.replace(/^[._-]+/, '').replace(/[._-]+$/, '');
            const localWithNumber = Math.random() < 0.25 ? `${localSanitized}${randomNum(1, 99)}` : localSanitized;
            const tldOptions = ['co.jp', 'jp', 'com'];
            const email = `${localWithNumber}@${emailDomain}.${tldOptions[randomNum(0, tldOptions.length - 1)]}`;
            const urlFormats = [
              () => `https://www.${emailDomain}.co.jp`,
              () => `https://${emailDomain}.co.jp`,
              () => `https://www.${emailDomain}.jp`,
              () => `https://${emailDomain}.jp`,
              () => `https://${emailDomain}.com`
            ];
            const url = urlFormats[randomNum(0, urlFormats.length - 1)]();

            return {
              cardNumber: String(randomNum(100, 9999)).padStart(4, '0'),
              companyName,
              name,
              position,
              zipCode: location.zip,
              address,
              phone: generatePhone(location.area),
              fax: Math.random() > 0.5 ? generatePhone(location.area) : '',
              mobile: Math.random() > 0.4 ? generateMobile() : '',
              email,
              url
            };
          };

          const formatTime = (ms) => {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const remainingMs = Math.floor((ms % 1000) / 100);
            
            if (minutes > 0) {
              return `${minutes}:${String(remainingSeconds).padStart(2, '0')}.${remainingMs}`;
            }
            return `${remainingSeconds}.${remainingMs}ç§’`;
          };

          const startTraining = (isReview = false) => {
            const cards = isReview && incorrectQuestions.length > 0
              ? incorrectQuestions
              : Array.from({ length: totalQuestions }, () => generateCard());
            
            setQuestions(cards);
            setCurrentIndex(0);
            setResults([]);
            setAnswers({});
            setShowResult(false);
            setReviewMode(isReview);
            setStartTime(Date.now());
            setQuestionStartTime(Date.now());
            setTimeTaken([]);
            setCurrentTime(0);
            setScreen('training');
          };

          const handleFieldToggle = (field) => {
            setSelectedFields(prev => ({ ...prev, [field]: !prev[field] }));
          };

          const handleAnswerChange = (field, value) => {
            setAnswers(prev => ({ ...prev, [field]: value }));
          };

          const checkAnswers = () => {
            const current = questions[currentIndex];
            const result = {};
            let correct = 0;
            let total = 0;
            const questionTime = Date.now() - questionStartTime;

            Object.keys(selectedFields).forEach(field => {
              if (selectedFields[field]) {
                total++;
                const userAnswer = (answers[field] || '').trim();
                const correctAnswer = (current[field] || '').trim();
                const isCorrect = userAnswer === correctAnswer;
                result[field] = { 
                  correct: isCorrect, 
                  userAnswer, 
                  correctAnswer 
                };
                if (isCorrect) correct++;
              }
            });

            setResults([...results, { ...result, score: { correct, total }, timeTaken: questionTime }]);
            setTimeTaken([...timeTaken, questionTime]);
            setShowResult(true);
          };

          const canProceed = () => {
            if (!showResult) return false;
            
            const current = questions[currentIndex];
            return Object.keys(selectedFields).every(field => {
              if (!selectedFields[field]) return true;
              const userAnswer = (answers[field] || '').trim();
              const correctAnswer = (current[field] || '').trim();
              return userAnswer === correctAnswer;
            });
          };

          const nextQuestion = () => {
            if (currentIndex < questions.length - 1) {
              setCurrentIndex(currentIndex + 1);
              setAnswers({});
              setShowResult(false);
              setQuestionStartTime(Date.now());
              setCurrentTime(0);
            } else {
              const totalTime = Date.now() - startTime;
              const totalCorrect = results.reduce((sum, r) => sum + r.score.correct, 0) + 
                                   (results[currentIndex]?.score.correct || 0);
              const totalQuestions = results.reduce((sum, r) => sum + r.score.total, 0) + 
                                    (results[currentIndex]?.score.total || 0);
              
              const incorrect = [];
              results.forEach((r, idx) => {
                const hasIncorrect = Object.keys(r).some(field => {
                  if (field === 'score' || field === 'timeTaken') return false;
                  return !r[field].correct;
                });
                if (hasIncorrect) {
                  incorrect.push(questions[idx]);
                }
              });

              setIncorrectQuestions(incorrect);

              const sessionData = {
                date: new Date().toISOString(),
                mode: reviewMode ? 'å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰' : 'é€šå¸¸ãƒ¢ãƒ¼ãƒ‰',
                totalQuestions,
                correct: totalCorrect,
                percentage: Math.round((totalCorrect / totalQuestions) * 100),
                totalTime,
                averageTime: Math.round(totalTime / questions.length),
                selectedFields: { ...selectedFields },
                incorrectCount: incorrect.length
              };

              const newHistory = [sessionData, ...history].slice(0, 50);
              setHistory(newHistory);
              localStorage.setItem('trainingHistory', JSON.stringify(newHistory));

              setScreen('result');
            }
          };

          const restart = () => {
            setScreen('setup');
            setCurrentIndex(0);
            setResults([]);
            setAnswers({});
            setShowResult(false);
            setReviewMode(false);
          };

          const viewHistory = () => {
            setScreen('history');
          };

          const deleteHistory = (index) => {
            const newHistory = history.filter((_, i) => i !== index);
            setHistory(newHistory);
            localStorage.setItem('trainingHistory', JSON.stringify(newHistory));
          };

          const clearAllHistory = () => {
            if (confirm('ã™ã¹ã¦ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
              setHistory([]);
              localStorage.removeItem('trainingHistory');
            }
          };

          const currentCard = questions[currentIndex];
          const activeFieldsCount = Object.values(selectedFields).filter(v => v).length;

          if (screen === 'setup') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-3xl mx-auto">
                  <div className="bg-white rounded-lg shadow-xl p-8">
                    <div className="text-center mb-8">
                      <div className="text-6xl mb-4">ğŸ“‡</div>
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">ååˆºå…¥åŠ›ã‚¢ãƒ—ãƒª</h1>
                      <p className="text-gray-600">å•é¡Œæ•°ã¨å…¥åŠ›é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                    </div>

                    <div className="mb-8">
                      <h2 className="text-xl font-bold mb-4 text-gray-800">å•é¡Œæ•°ã‚’é¸æŠ</h2>
                      <div className="grid grid-cols-3 gap-4">
                        {[10, 30, 50, 100, 200, 300].map(num => (
                          <button
                            key={num}
                            onClick={() => setTotalQuestions(num)}
                            className={`py-4 px-6 rounded-lg font-bold text-lg transition-all ${
                              totalQuestions === num
                                ? 'bg-indigo-600 text-white shadow-lg scale-105'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {num}å•
                          </button>
                        ))}
                      </div>
                    </div>

                    <div className="mb-8">
                      <h2 className="text-xl font-bold mb-4 text-gray-800">
                        å…¥åŠ›é …ç›®ã‚’é¸æŠ 
                        <span className="text-sm font-normal text-gray-500 ml-2">
                          ({activeFieldsCount}é …ç›®é¸æŠä¸­)
                        </span>
                      </h2>
                      <div className="grid grid-cols-2 gap-3">
                        {Object.keys(fieldLabels).map(field => (
                          <label
                            key={field}
                            className={`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all ${
                              selectedFields[field]
                                ? 'border-indigo-600 bg-indigo-50'
                                : 'border-gray-200 bg-white hover:bg-gray-50'
                            }`}
                          >
                            <input
                              type="checkbox"
                              checked={selectedFields[field]}
                              onChange={() => handleFieldToggle(field)}
                              className="w-5 h-5 text-indigo-600 rounded"
                            />
                            <span className="ml-3 font-medium text-gray-700">
                              {fieldLabels[field]}
                            </span>
                          </label>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-3">
                      <button
                        onClick={() => startTraining(false)}
                        disabled={activeFieldsCount === 0}
                        className={`w-full py-4 px-6 rounded-lg font-bold text-lg transition-all ${
                          activeFieldsCount === 0
                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg hover:scale-105'
                        }`}
                      >
                        ğŸš€ ç·´ç¿’ã‚’é–‹å§‹ã™ã‚‹
                      </button>

                      {incorrectQuestions.length > 0 && (
                        <button
                          onClick={() => startTraining(true)}
                          className="w-full py-4 px-6 rounded-lg font-bold text-lg bg-orange-600 text-white hover:bg-orange-700 shadow-lg hover:scale-105 transition-all"
                        >
                          ğŸ“š å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ ({incorrectQuestions.length}å•)
                        </button>
                      )}

                      {history.length > 0 && (
                        <button
                          onClick={viewHistory}
                          className="w-full py-3 px-6 rounded-lg font-bold text-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all"
                        >
                          ğŸ“Š ç·´ç¿’å±¥æ­´ã‚’è¦‹ã‚‹
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'training' && currentCard) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="mb-6 flex justify-between items-center">
                    <div>
                      <div className="text-lg font-bold text-gray-700">
                        {reviewMode ? 'ğŸ“š å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰' : ''} å•é¡Œ {currentIndex + 1} / {questions.length}
                      </div>
                      <div className="text-2xl font-bold text-indigo-600 mt-1">
                        â±ï¸ {formatTime(currentTime)}
                      </div>
                    </div>
                    <div className="flex items-center gap-4">
                      <div className="text-sm text-gray-600">
                        æ­£è§£æ•°: {results.reduce((sum, r) => sum + r.score.correct, 0)} / 
                        {results.reduce((sum, r) => sum + r.score.total, 0)}
                      </div>
                      <button
                        onClick={restart}
                        className="px-4 py-2 text-sm font-bold rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 transition-all"
                      >
                        ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-6 items-start">
                    <div className="bg-white rounded-lg shadow-xl p-8 lg:sticky lg:top-6 self-start">
                      <h2 className="text-xl font-bold mb-4 text-center text-gray-800">ååˆº</h2>
                      <div className="bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300 rounded-lg p-6 shadow-inner">
                        <div className="mb-4 pb-3 border-b-2 border-indigo-600">
                          <div className="text-xs text-indigo-600 font-bold mb-2">No.{currentCard.cardNumber}</div>
                          <div className="text-lg font-bold text-indigo-700 mb-1">{currentCard.companyName}</div>
                        </div>
                        <div className="mb-4">
                          <div className="text-2xl font-bold text-gray-800 mb-2">{currentCard.name}</div>
                          <div className="text-base text-gray-600">{currentCard.position}</div>
                        </div>
                        <div className="space-y-1 text-sm text-gray-700">
                          <div className="flex">
                            <span className="w-16 font-bold">ã€’</span>
                            <span>{currentCard.zipCode}</span>
                          </div>
                          <div className="flex">
                            <span className="w-16"></span>
                            <span>{currentCard.address}</span>
                          </div>
                          <div className="flex">
                            <span className="w-16 font-bold">TEL:</span>
                            <span>{currentCard.phone}</span>
                          </div>
                          {currentCard.fax && (
                            <div className="flex">
                              <span className="w-16 font-bold">FAX:</span>
                              <span>{currentCard.fax}</span>
                            </div>
                          )}
                          {currentCard.mobile && (
                            <div className="flex">
                              <span className="w-16 font-bold">Mobile:</span>
                              <span>{currentCard.mobile}</span>
                            </div>
                          )}
                          <div className="flex">
                            <span className="w-16 font-bold">Email:</span>
                            <span className="text-xs">{currentCard.email}</span>
                          </div>
                          <div className="flex">
                            <span className="w-16 font-bold">URL:</span>
                            <span className="text-xs">{currentCard.url}</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-xl p-8 lg:max-h-[calc(100vh-160px)] lg:overflow-y-auto lg:pr-2">
                      <h2 className="text-xl font-bold mb-4 text-center text-gray-800">å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h2>
                      <div className="space-y-4">
                        {Object.keys(selectedFields).map(field => {
                          if (!selectedFields[field]) return null;
                          
                          const result = showResult && results[currentIndex]?.[field];
                          const userAnswer = (answers[field] || '').trim();
                          const correctAnswer = currentCard[field] || '';
                          const isCorrect = showResult ? userAnswer === correctAnswer : result?.correct;
                          
                          return (
                            <div key={field}>
                              <label className="block text-sm font-bold text-gray-700 mb-1">
                                {fieldLabels[field]}
                              </label>
                              <input
                                type="text"
                                value={answers[field] || ''}
                                onChange={(e) => handleAnswerChange(field, e.target.value)}
                                disabled={showResult && isCorrect}
                                className={`w-full px-4 py-2 border-2 rounded-lg transition-all ${
                                  showResult
                                    ? isCorrect
                                      ? 'border-green-500 bg-green-50'
                                      : 'border-red-500 bg-white focus:border-red-600 focus:outline-none'
                                    : 'border-gray-300 focus:border-indigo-500 focus:outline-none'
                                }`}
                                placeholder={showResult && !isCorrect ? 'æ­£è§£ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' : ''}
                              />
                              {showResult && !isCorrect && (
                                <div className="mt-1 text-sm">
                                  <div className="text-red-600">âœ— å…¥åŠ›: {result.userAnswer || '(æœªå…¥åŠ›)'}</div>
                                  <div className="text-green-600">âœ“ æ­£è§£: {result.correctAnswer}</div>
                                </div>
                              )}
                            </div>
                          );
                        })}
                      </div>

                      <div className="mt-6 space-y-3">
                        {!showResult ? (
                          <button
                            onClick={checkAnswers}
                            className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition-all shadow-lg"
                          >
                            âœ“ ç­”ãˆåˆã‚ã›
                          </button>
                        ) : (
                          <>
                            <div className="text-center p-4 bg-gray-100 rounded-lg">
                              <div className="text-2xl font-bold text-gray-800">
                                {results[currentIndex].score.correct} / {results[currentIndex].score.total} æ­£è§£
                              </div>
                              <div className="text-sm text-gray-600 mt-1">
                                â±ï¸ {formatTime(results[currentIndex].timeTaken)}
                              </div>
                              {!canProceed() && (
                                <div className="mt-2 text-sm text-red-600 font-medium">
                                  âš  ã™ã¹ã¦ã®é …ç›®ã«æ­£è§£ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                                </div>
                              )}
                            </div>
                            <button
                              onClick={nextQuestion}
                              disabled={!canProceed()}
                              className={`w-full py-3 rounded-lg font-bold transition-all ${
                                canProceed()
                                  ? 'bg-green-600 text-white hover:bg-green-700'
                                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                              }`}
                            >
                              â†’ {currentIndex < questions.length - 1 ? 'æ¬¡ã®å•é¡Œã¸' : 'çµæœã‚’è¦‹ã‚‹'}
                            </button>
                          </>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'result') {
            const totalCorrect = results.reduce((sum, r) => sum + r.score.correct, 0);
            const totalQuestions = results.reduce((sum, r) => sum + r.score.total, 0);
            const percentage = Math.round((totalCorrect / totalQuestions) * 100);
            const totalTime = results.reduce((sum, r) => sum + r.timeTaken, 0);
            const averageTime = Math.round(totalTime / results.length);

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-2xl mx-auto">
                  <div className="bg-white rounded-lg shadow-xl p-8">
                    <div className="text-center mb-8">
                      <div className="text-6xl mb-4">
                        {percentage >= 90 ? 'ğŸ†' : percentage >= 70 ? 'ğŸ‰' : percentage >= 50 ? 'ğŸ‘' : 'ğŸ’ª'}
                      </div>
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">
                        {reviewMode ? 'å¾©ç¿’å®Œäº†!' : 'ç·´ç¿’å®Œäº†!'}
                      </h1>
                      <div className="text-5xl font-bold text-indigo-600 my-6">
                        {totalCorrect} / {totalQuestions}
                      </div>
                      <div className="text-2xl font-bold text-gray-700">
                        æ­£è§£ç‡: {percentage}%
                      </div>
                      <div className="mt-4 space-y-2">
                        <div className="text-lg text-gray-600">
                          â±ï¸ åˆè¨ˆæ™‚é–“: {formatTime(totalTime)}
                        </div>
                        <div className="text-lg text-gray-600">
                          ğŸ“Š å¹³å‡æ™‚é–“: {formatTime(averageTime)}
                        </div>
                      </div>
                    </div>

                    <div className="mb-8">
                      <h2 className="text-xl font-bold mb-4 text-gray-800">é …ç›®åˆ¥æ­£è§£ç‡</h2>
                      <div className="space-y-2">
                        {Object.keys(selectedFields).map(field => {
                          if (!selectedFields[field]) return null;
                          
                          const fieldResults = results.map(r => r[field]).filter(Boolean);
                          const correct = fieldResults.filter(r => r.correct).length;
                          const total = fieldResults.length;
                          const rate = Math.round((correct / total) * 100);
                          
                          return (
                            <div key={field} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                              <span className="font-medium text-gray-700">{fieldLabels[field]}</span>
                              <div className="flex items-center gap-3">
                                <span className="text-sm text-gray-600">{correct}/{total}</span>
                                <span className={`font-bold ${rate >= 80 ? 'text-green-600' : rate >= 60 ? 'text-yellow-600' : 'text-red-600'}`}> {
                                  rate}%
                                </span>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    {incorrectQuestions.length > 0 && !reviewMode && (
                      <div className="mb-6 p-4 bg-orange-50 border-2 border-orange-200 rounded-lg">
                        <div className="text-center">
                          <div className="text-orange-700 font-bold mb-2">
                            ğŸ’¡ é–“é•ãˆãŸå•é¡ŒãŒ {incorrectQuestions.length} å•ã‚ã‚Šã¾ã™
                          </div>
                          <button
                            onClick={() => {
                              startTraining(true);
                            }}
                            className="px-6 py-2 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition-all"
                          >
                            å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã§å†æŒ‘æˆ¦
                          </button>
                        </div>
                      </div>
                    )}

                    <button
                      onClick={restart}
                      className="w-full py-4 bg-indigo-600 text-white rounded-lg font-bold text-lg hover:bg-indigo-700 transition-all shadow-lg"
                    >
                      â†» æœ€åˆã«æˆ»ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'history') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-lg shadow-xl p-8">
                    <div className="flex justify-between items-center mb-6">
                      <h1 className="text-3xl font-bold text-gray-800">ğŸ“Š ç·´ç¿’å±¥æ­´</h1>
                      <div className="space-x-2">
                        {history.length > 0 && (
                          <button
                            onClick={clearAllHistory}
                            className="px-4 py-2 text-sm font-bold rounded-lg bg-red-100 text-red-700 hover:bg-red-200 transition-all"
                          >
                            ã™ã¹ã¦å‰Šé™¤
                          </button>
                        )}
                        <button
                          onClick={restart}
                          className="px-4 py-2 text-sm font-bold rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 transition-all"
                        >
                          ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                        </button>
                      </div>
                    </div>

                    {history.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">ğŸ“</div>
                        <p className="text-gray-600 text-lg">ã¾ã ç·´ç¿’å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {history.map((session, index) => (
                          <div key={index} className="border-2 border-gray-200 rounded-lg p-4 hover:border-indigo-300 transition-all">
                            <div className="flex justify-between items-start">
                              <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                  <span className="text-sm text-gray-500">
                                    {new Date(session.date).toLocaleString('ja-JP')}
                                  </span>
                                  {session.mode === 'å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰' && (
                                    <span className="px-2 py-1 text-xs font-bold bg-orange-100 text-orange-700 rounded">
                                      å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰
                                    </span>
                                  )}
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                  <div>
                                    <div className="text-xs text-gray-500">æ­£è§£ç‡</div>
                                    <div className={`text-2xl font-bold ${
                                      session.percentage >= 80 ? 'text-green-600' : 
                                      session.percentage >= 60 ? 'text-yellow-600' : 'text-red-600'
                                    }`}> {
                                      session.percentage}%
                                    </div>
                                  </div>
                                  <div>
                                    <div className="text-xs text-gray-500">æ­£è§£æ•°</div>
                                    <div className="text-lg font-bold text-gray-700">
                                      {session.correct}/{session.totalQuestions}
                                    </div>
                                  </div>
                                  <div>
                                    <div className="text-xs text-gray-500">åˆè¨ˆæ™‚é–“</div>
                                    <div className="text-lg font-bold text-gray-700">
                                      {formatTime(session.totalTime)}
                                    </div>
                                  </div>
                                  <div>
                                    <div className="text-xs text-gray-500">å¹³å‡æ™‚é–“</div>
                                    <div className="text-lg font-bold text-gray-700">
                                      {formatTime(session.averageTime)}
                                    </div>
                                  </div>
                                </div>
                                <div className="mt-3 flex flex-wrap gap-1">
                                  {Object.keys(session.selectedFields).map(field => 
                                    session.selectedFields[field] && (
                                      <span key={field} className="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded">
                                        {fieldLabels[field]}
                                      </span>
                                    )
                                  )}
                                </div>
                              </div>
                              <button
                                onClick={() => deleteHistory(index)}
                                className="ml-4 text-red-600 hover:text-red-800 transition-all"
                                title="å‰Šé™¤"
                              >
                                ğŸ—‘ï¸
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<BusinessCardTrainingApp />, document.getElementById('root'));
    </script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js');
        });
      }
    </script>
</body>
</html>
<script>
  const addresses = [
    // other entries
    { zip: '260-0013', pref: 'åƒè‘‰çœŒ', city: 'åƒè‘‰å¸‚ä¸­å¤®åŒºä¸­å¤®', area: '043' },
    // other entries
  ];
</script>
